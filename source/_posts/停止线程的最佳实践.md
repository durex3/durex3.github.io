---
title: 停止线程的最佳实践
date: 2020-06-03 22:20:29
categories:
- 多线程
tags:
- Java
- 多线程
---

要使任务和线程能安全、快速、可靠地停止下来,并不是一件容易的事。Java没有提供任何机制来安全地终止线程。但它提供了中断( Interruption),这是一种协作机制,能够使一个线程终止另一个线程的当前工作。
<!-- more -->
在Java中，最好的停止线程的方式是使用中断interrupt，但是这仅仅是会通知到被终止的线程“你该停止运行了”，被终止的线程自身拥有决定权（决定是否、以及何时停止），这依赖于请求停止方和被停止方都遵守一种约定好的编码规范。

## 1. 通常情况下的停止线程

```java

	/**
	 * run方法内没有sleep或者wait方法时，停止线程
	 * @author gelong
	 * @date 2020/6/3 22:16
	 */
	public class RightWayStopThreadWithoutSleep {
	
	    public static void main(String[] args) throws InterruptedException {
	        Thread thread = new Thread(() -> {
	            int num = 0;
	            while (!Thread.currentThread().isInterrupted() && num <= Integer.MAX_VALUE / 2) {
	                if (num % 10000 == 0) {
	                    System.out.println(num + "是10000的倍数");
	                }
	                num++;
	            }
	        });
	        thread.start();
	        Thread.sleep(2000);
	        thread.interrupt();
	        System.out.println("任务结束了");
	    }
	}
```

![stopthread1.jpg](http://ww1.sinaimg.cn/large/b1bbb565gy1gffibei9fzj20e0084mxh.jpg)

当在main线程里面调用thread.interrupt()给线程中断的信号时，isInterrupted()方法就会返回true，while条件不满足就会退出循环，此时线程就会退出了。

## 2. 当线程中断遇到遇到等待状态时

```java

	/**
	 * @author gelong
	 * @date 2020/6/3 23:24
	 */
	public class RightWayStopThreadWithSleep {
	
	    public static void main(String[] args) throws InterruptedException {
	        Thread thread = new Thread(() -> {
	            try {
	                Thread.sleep(1000);
	            } catch (InterruptedException e) {
	                e.printStackTrace();
	            }
	        });
	        thread.start();
	        Thread.sleep(500);
	        thread.interrupt();
	        System.out.println("任务结束了");
	    }
	}
```

![stopthread2.jpg](http://ww1.sinaimg.cn/large/b1bbb565gy1gffiw2j2u4j213z06b0ta.jpg)

当线程在等待状态时收到中断信号时，会抛出InterruptedException异常。